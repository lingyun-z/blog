## CommonJs 规范

在 Node 中，为了实现模块化，引入了 CommonJs 规范。在 CommonJs 规范中主要将模块的定义分为了三个部分：

1. 模块引用  
   通过`require()`方法引入模块。
2. 模块定义  
   `module`对象代表模块本身。  
   `exports`对象是`module`的属性，用于导出当前模块的方法或变量。
   `exports`属性上的任何方法和属性都可以被外部调用，但是其余变量不可直接被调用。
3. 模块标识  
   作为`require()`方法的参数，可以简单理解为文件路径。

## Node 模块的实现

### 模块引用步骤

---

在 Node 中引用模块需要经历三个步骤：

1. 路径分析
2. 文件定位
3. 编译执行

### 模块类型

---

Node 中的模块主要分为三个类型：

1. 核心模块（由 Node 提供的模块）  
   在 Node 启动时完成加载，直接载入二进制文件读入内存。不需要经过文件定位和编译执行的步骤。

2. 文件模块（由用户编写模块）  
   在 Node 运行时动态加载，需要经历模块引入完整的三个步骤。

3. 自定义模块（第三方模块 node_module）  
   在文件定位时，沿路经向上逐级递归，访问每个路径下的 node_module 文件夹

### 模块缓存

---

在加载模块时，需要调用 `fs` 模块同步阻塞式地判断文件是否存在。在 Node 中会对已经经过一次引用的模块进行缓存。缓存模块在编译和执行之后的对象，来减少二次引入时的开销

### 模块编译

1. `js`文件  
   `fs` 模块同步读取模块后编译执行
2. `node`文件
   使用`C/C++`编写的扩展文件。通过`process.dlopen()`的方法加载编译生成的文件
3. `json`文件
   经过`fs`模块同步读取后用 `JSON.parse` 解析返回结果
